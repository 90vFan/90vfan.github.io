<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=6.7.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.7.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.7.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.7.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.7.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="SAILOR">
<meta property="og:url" content="http:/index.html">
<meta property="og:site_name" content="SAILOR">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="SAILOR">






  <link rel="canonical" href="http:/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>SAILOR</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">SAILOR</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">BLOG</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http:/2019/10/09/coding/重构/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Joseph.Fan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SAILOR">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/10/09/coding/重构/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-10-09 01:30:37" itemprop="dateCreated datePublished" datetime="2019-10-09T01:30:37+08:00">2019-10-09</time>
            

            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="重构：改善既有代码的设计"><a href="#重构：改善既有代码的设计" class="headerlink" title="重构：改善既有代码的设计"></a>重构：改善既有代码的设计</h2><h2 id="Chapter-1"><a href="#Chapter-1" class="headerlink" title="Chapter 1"></a>Chapter 1</h2><p>如果你要给程序添加一个特性，但发现代码因缺乏<strong>良好的结构</strong>而<strong>不易于进行更改</strong>，那就先重构那个程序，使其比较容易添加该特性，然后再添加该特性。</p>
<p>重构前，先检查自己是否有一套可靠的测试集。这些测试必须有自我检验能力。进行重构时，我需要依赖测试。我将测试视为bug检测器，它们能保护我不被自己犯的错误所困扰。通过测试对当前工作进行二次确认。</p>
<p><strong>重构技术就是以微小的步伐修改程序。如果你犯下错误，很容易便可发现它。</strong></p>
<p>傻瓜都能写出计算机可以理解的代码。唯有能写出<strong>人类容易理解的代码</strong>的，才是优秀的程序员。</p>
<p>好代码的检验标准就是人们是否能轻而易举地修改它。小的步子可以更快前进，请保持代码永远处于可工作状态，小步修改累积起来也能大大改善系统的设计。</p>
<h2 id="Chapter-2-重构"><a href="#Chapter-2-重构" class="headerlink" title="Chapter 2 重构"></a>Chapter 2 重构</h2><h4 id="WHY"><a href="#WHY" class="headerlink" title="WHY"></a>WHY</h4><ul>
<li>改进软件设计</li>
<li>使软件更容易理解。通过重构，我就把脑子里的理解转移到了代码本身</li>
<li>帮助找到 bug</li>
<li>提高编程速度</li>
</ul>
<h4 id="见机行事的重构"><a href="#见机行事的重构" class="headerlink" title="见机行事的重构"></a>见机行事的重构</h4><p>大部分重构应该是不起眼的、见机行事的。</p>
<ul>
<li>帮助理解</li>
<li>捡垃圾式重构</li>
</ul>
<p><em>？？？</em></p>
<p>我听过的一条建议是：将重构与添加新功能在版本控制的提交中分开。这样做的一大好处是可以各自独立地审阅和批准这些提交。但我并不认同这种做法。重构常常与新添功能紧密交织，不值得花工夫把它们分开。并且这样做也使重构脱离了上下文，使人看不出这些“重构提交”的价值。每个团队应该尝试并找出适合自己的工作方式，只是要记住：分离重构提交并不是毋庸置疑的原则，只有当你真的感到有益时，才值得这样做</p>
<p>============================</p>
<h4 id="有计划的重构"><a href="#有计划的重构" class="headerlink" title="有计划的重构"></a>有计划的重构</h4><ul>
<li>添加新功能最快的方法往往是先修改现有的代码，使新功能容易被加入。</li>
</ul>
<p>每当有人靠近“重构区”的代码，就把它朝想要改进的方向推动一点。这个策略的好处在于，重构不会破坏代码——每次小改动之后，整个系统仍然照常工作。例如，如果想替换掉一个正在使用的库，可以先引入一层新的抽象，使其兼容新旧两个库的接口。一旦调用方已经完全改为使用这层抽象，替换下面的库就会容易得多。（这个策略叫作Branch By Abstraction[mf-bba]。）</p>
<ul>
<li>复审代码时重构</li>
<li>重写</li>
</ul>
<p>重构的唯一目的就是让我们开发更快，用更少的工作量创造更大的价值。</p>
<h4 id="发布接口-public-interface"><a href="#发布接口-public-interface" class="headerlink" title="发布接口 public interface"></a>发布接口 public interface</h4><p>可以把旧的接口标记为“不推荐使用”（deprecated），等一段时间之后最终让其退休；但有些时候，旧的接口必须一直保留下去。</p>
<h4 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h4><p>在隔离的分支上工作得越久，将完成的工作集成（integrate）回主线就会越困难。</p>
<p>持续集成（Continuous Integration，CI），也叫“基于主干开发”（Trunk-Based Development）。在使用CI时，每个团队成员每天至少向主线集成一次。这个实践避免了任何分支彼此差异太大，从而极大地降低了合并的难度。不过CI也有其代价：你必须使用相关的实践以确保主线随时处于健康状态，必须学会将大功能拆分成小块，还必须使用特性开关（feature toggle，也叫特性旗标，feature flag）将尚未完成又无法拆小的功能隐藏掉。</p>
<h4 id="YAGNI"><a href="#YAGNI" class="headerlink" title="YAGNI"></a>YAGNI</h4><p>简单设计、增量式设计或者YAGNI[mf-yagni]——“你不会需要它”（you arenʼt going to need it）的缩写</p>
<p>把YAGNI视为将架构、设计与开发过程融合的一种工作方式，这种工作方式必须有重构作为基础才可靠。</p>
<p>”演进式架构“</p>
<h4 id="自测试代码、持续集成、重构"><a href="#自测试代码、持续集成、重构" class="headerlink" title="自测试代码、持续集成、重构"></a>自测试代码、持续集成、重构</h4><p>重构（及其前置实践）是YAGNI的基础，YAGNI又让重构更易于开展</p>
<h2 id="Chapter-3-Bad-Smell"><a href="#Chapter-3-Bad-Smell" class="headerlink" title="Chapter 3 Bad Smell"></a>Chapter 3 Bad Smell</h2><h4 id="清楚的命名"><a href="#清楚的命名" class="headerlink" title="清楚的命名"></a>清楚的命名</h4><h4 id="提炼函数"><a href="#提炼函数" class="headerlink" title="提炼函数"></a>提炼函数</h4><p>函数越长，就越难理解</p>
<p><em>注释</em></p>
<p>每当感觉需要以注释来说明点什么的时候，我们就把需要说明的东西写进一个独立函数中，并<strong>以其用途（而非实现手法）命名*</strong>。关键不在于函数的长度，而在于函数“做什么”和“如何做”之间的语义距离。</p>
<p>如果代码前方有一行<strong>注释</strong>，就是在提醒你：可以将这段代码替换成一个函数，而且可以在注释的基础上给这个函数命名。</p>
<p><em>循环</em></p>
<p><strong>条件表达式和循环</strong>常常也是提炼的信号。你可以使用分解条件表达式（260）处理条件表达式。对于庞大的<code>switch</code>语句，其中的每个分支都应该通过提炼函数（106）变成独立的函数调用。如果有多个<code>switch</code>语句基于同一个条件进行分支选择，就应该使用以多态取代条件表达式（272）。</p>
<p>至于循环，你应该将循环和循环内的代码提炼到一个独立的函数中。如果你发现提炼出的循环很难命名，可能是因为其中做了几件不同的事。如果是这种情况，请勇敢地使用拆分循环（227）将其拆分成各自独立的任务。</p>
<h4 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h4><p>把全局数据用一个函数封装装起来</p>
<p>全局数据印证了帕拉塞尔斯的格言：良药与毒药的区别在于剂量。有少量的全局数据或许无妨，但数量越多，处理的难度就会指数上升。</p>
<p>可以用封装变量来确保所有数据更新操作都通过很少几个函数来进行，查询函数和修改函数分离</p>
<p>如果一个变量在其内部结构中包含了数据，通常最好不要直接修改其中的数据，而是用将引用对象改为值对象令其直接替换整个数据结构</p>
<h4 id="循环"><a href="#循环" class="headerlink" title="循环"></a>循环</h4><p>使用以管道取代循环，管道操作（如filter和map）可以帮助我们更快地看清被处理的元素以及处理它们的动作</p>
<h4 id="过大的类"><a href="#过大的类" class="headerlink" title="过大的类"></a>过大的类</h4><p>是把多余的东西消弭于类内部。如果有5个“百行函数”，它们之中很多代码都相同，那么或许你可以把它们变成5个“十行函数”和10个提炼出来的“双行函数”。</p>
<h4 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h4><p>当你感觉需要撰写注释时，请先尝试重构，试着让所有注释都变得多余。</p>
<p>如果你需要注释来解释一块代码做了什么，试试提炼函数；如果函数已经提炼出来，但还是需要注释来解释其行为，试试用改变函数声明为它改名；如果你需要注释说明某些系统的需求规格，试试引入断言。</p>
<p>应该添加的情况：如果你不知道该做什么，记述将来的打算，标记你并无十足把握的区域，写下自己“为什么做某某事”。这类信息可以帮助将来的修改者，尤其是那些健忘的家伙。</p>
<h2 id="Chapter-4-测试"><a href="#Chapter-4-测试" class="headerlink" title="Chapter 4 测试"></a>Chapter 4 测试</h2><h4 id="WHY-1"><a href="#WHY-1" class="headerlink" title="WHY"></a>WHY</h4><ul>
<li><p>编写代码的时间仅占所有时间中很少的一部分。有些时间用来决定下一步干什么，有些时间花在设计上，但是，<strong>花费在调试上的时间是最多的</strong></p>
</li>
<li><p>修复bug通常是比较快的，但<strong>找出bug所在却是一场噩梦</strong>。当修复一个bug时，常常会引起另一个bug，却在很久之后才会注意到它。那时，你又要花上大把时间去定位问题。</p>
</li>
<li><p>一套测试就是一个强大的bug侦测器，能够大大缩减查找bug所需的时间</p>
</li>
<li>除非体会到<strong>编写测试是如何提升编程速度</strong>，否则自测试似乎就没有什么意义</li>
<li><p><strong>编写未臻完善的测试</strong>并经常运行，好过对完美测试的无尽等待。</p>
</li>
<li><p><strong>一个测试语句中最好只有一个验证语句</strong>，否则测试可能在进行第一个验证时就失败，这通常会掩盖一些重要的错误信息，不利于你了解测试失败的原因。</p>
</li>
</ul>
<h4 id="错误，脏数据"><a href="#错误，脏数据" class="headerlink" title="错误，脏数据"></a>错误，脏数据</h4><p><strong>直接 assert</strong></p>
<p>如果这个错误会导致脏数据在应用中到处传递，或是产生一些很难调试的失败，我可能会用<strong>引入断言</strong>（302）手法，使代码不满足预设条件时快速失败。我不会为这样的失败断言添加测试，它们本身就是一种测试的形式。</p>
<h4 id="探测边界条件"><a href="#探测边界条件" class="headerlink" title="探测边界条件"></a>探测边界条件</h4><ul>
<li>目前为止我的测试都聚焦于正常的行为上，这通常也被称为“正常路径”（happy path），它指的是一切工作正常、用户使用方式也最符合规范的那种场景。同时，把测试推到这些条件的边界处也是不错的实践，这可以检查操作出错时软件的表现。</li>
<li>考虑<strong>可能出错的边界条件</strong>，把测试火力集中在那儿。</li>
</ul>
<h4 id="你应该把测试集中在可能出错的地方。观察代码，看哪儿变得复杂；观察函数，思考哪些地方可能出错。"><a href="#你应该把测试集中在可能出错的地方。观察代码，看哪儿变得复杂；观察函数，思考哪些地方可能出错。" class="headerlink" title="你应该把测试集中在可能出错的地方。观察代码，看哪儿变得复杂；观察函数，思考哪些地方可能出错。"></a>你应该把测试集中在可能出错的地方。观察代码，看哪儿变得复杂；观察函数，思考哪些地方可能出错。</h4><ul>
<li>不要因为测试无法捕捉所有的bug就不写测试，因为测试的确可以捕捉到大多数bug</li>
</ul>
<h4 id="单元测试"><a href="#单元测试" class="headerlink" title="单元测试"></a>单元测试</h4><p>负责测试一小块代码，运行速度足够快。它们是自测试代码的支柱，是一个系统中占绝大多数的测试类型</p>
<h4 id="测试三问"><a href="#测试三问" class="headerlink" title="测试三问"></a>测试三问</h4><p>与编程的许多方面类似，测试也是一种<strong>迭代</strong>式的活动。除非你技能非常纯熟，或者非常幸运，否则你很难第一次就把测试写对。我发觉我持续地在测试集上工作，就与我在主代码库上的工作一样多。很自然，这意味着我在增加新特性时也要同时添加测试。</p>
<p>有时还需要回顾已有的测试：它们足够清晰吗？我需要重构它们，以帮助我更好地理解吗？我拥有的测试是有价值的吗？</p>
<p>代码足够清晰吗？我需要重构它们，以帮助我更好地理解吗？</p>
<h4 id="什么时候应该添加测试"><a href="#什么时候应该添加测试" class="headerlink" title="什么时候应该添加测试"></a>什么时候应该添加测试</h4><p>每当你收到bug报告，请先写一个<strong>单元测试来暴露这个bug</strong>。</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http:/2019/10/08/machine-learning/feature-engineering-for-machine-learning/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Joseph.Fan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SAILOR">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/10/08/machine-learning/feature-engineering-for-machine-learning/" class="post-title-link" itemprop="url">Feature Engineering</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-10-08 00:00:00" itemprop="dateCreated datePublished" datetime="2019-10-08T00:00:00+08:00">2019-10-08</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-10-09 01:29:50" itemprop="dateModified" datetime="2019-10-09T01:29:50+08:00">2019-10-09</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/ml/" itemprop="url" rel="index"><span itemprop="name">ml</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Feature-Engineering"><a href="#Feature-Engineering" class="headerlink" title="Feature Engineering"></a>Feature Engineering</h2><h2 id="Charpter-2-简单数字的奇特技巧"><a href="#Charpter-2-简单数字的奇特技巧" class="headerlink" title="Charpter 2 简单数字的奇特技巧"></a>Charpter 2 简单数字的奇特技巧</h2><h3 id="二值化-０，１"><a href="#二值化-０，１" class="headerlink" title="二值化　０，１"></a>二值化　０，１</h3><h3 id="量化或装箱"><a href="#量化或装箱" class="headerlink" title="量化或装箱　　"></a>量化或装箱　　</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>small_counts</span><br><span class="line">array([<span class="number">30</span>, <span class="number">64</span>, <span class="number">49</span>, <span class="number">26</span>, <span class="number">69</span>, <span class="number">23</span>, <span class="number">56</span>, <span class="number">7</span>, <span class="number">69</span>, <span class="number">67</span>, <span class="number">87</span>, <span class="number">14</span>, <span class="number">67</span>, <span class="number">33</span>, <span class="number">88</span>, <span class="number">77</span>, <span class="number">75</span>, <span class="number">47</span>, <span class="number">44</span>, <span class="number">93</span>])</span><br><span class="line"><span class="comment">### Map to evenly spaced bins 0-9 by division</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>np.floor_divide(small_counts, <span class="number">10</span>)</span><br><span class="line">array([<span class="number">3</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">4</span>, <span class="number">9</span>], dtype=int32)</span><br><span class="line"></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>large_counts = [<span class="number">296</span>, <span class="number">8286</span>, <span class="number">64011</span>, <span class="number">80</span>, <span class="number">3</span>, <span class="number">725</span>, <span class="number">867</span>, <span class="number">2215</span>, <span class="number">7689</span>, <span class="number">11495</span>, <span class="number">91897</span>, <span class="number">44</span>, <span class="number">28</span>, <span class="number">7971</span>, <span class="number">926</span>, <span class="number">122</span>, <span class="number">22222</span>]</span><br><span class="line"><span class="comment">### Map to exponential-width bins via the log function</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>np.floor(np.log10(large_counts))</span><br><span class="line">array([ <span class="number">2.</span>, <span class="number">3.</span>, <span class="number">4.</span>, <span class="number">1.</span>, <span class="number">0.</span>, <span class="number">2.</span>, <span class="number">2.</span>, <span class="number">3.</span>, <span class="number">3.</span>, <span class="number">4.</span>, <span class="number">4.</span>, <span class="number">1.</span>, <span class="number">1.</span>, <span class="number">3.</span>, <span class="number">2.</span>, <span class="number">2.</span>, <span class="number">4.</span>])</span><br></pre></td></tr></table></figure>
<h3 id="分位数装箱"><a href="#分位数装箱" class="headerlink" title="分位数装箱"></a>分位数装箱</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### Map the counts to quartiles</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>pd.qcut(large_counts, <span class="number">4</span>, labels=<span class="keyword">False</span>)</span><br><span class="line">array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">3</span>], dtype=int64)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>large_counts_series.quantile([<span class="number">0.25</span>, <span class="number">0.5</span>, <span class="number">0.75</span>])</span><br><span class="line"><span class="number">0.25</span> <span class="number">122.0</span></span><br><span class="line"><span class="number">0.50</span> <span class="number">926.0</span></span><br><span class="line"><span class="number">0.75</span> <span class="number">8286.0</span></span><br><span class="line">dtype: float64</span><br></pre></td></tr></table></figure>
<h3 id="对数转换"><a href="#对数转换" class="headerlink" title="对数转换"></a>对数转换</h3><p>线性回归模型的训练过程假定预测误差分布得像高斯，对数变换，这是一种功率变换，将变量的分布接近高斯。</p>
<p>对数变换是处理具有重尾分布的正数的有力工具。（重尾分布在尾部范围内的概率比高斯分布的概率大）</p>
<p><img src="/2019/10/08/machine-learning/feature-engineering-for-machine-learning/2-8.png" alt="img"></p>
<p>使用$R^2$评分来评估，好的模型有较高的 R 方分数。一个完美的模型得到最高分1， 一个坏的模型可以得到一个任意低的负评分。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scores_log = cross_val_score(m_log, biz_df[[<span class="string">'log_review_count'</span>]], biz_df[<span class="string">'stars'</span>], cv=<span class="number">10</span>)</span><br><span class="line">scores_log.mean()  <span class="comment"># R^2</span></span><br></pre></td></tr></table></figure>
<p><img src="/2019/10/08/machine-learning/feature-engineering-for-machine-learning/2-9.png" alt="img"></p>
<p>对数变换将较大的离群值压缩到一个更小的范围内</p>
<h3 id="Box-Cox-transformation"><a href="#Box-Cox-transformation" class="headerlink" title="Box-Cox transformation"></a>Box-Cox transformation</h3><p>???</p>
<p>概率图(probplot)是一种直观地比较数据分布与理论分布的简单方法。</p>
<h3 id="特征缩放-Scaling-或归一化-Normalization"><a href="#特征缩放-Scaling-或归一化-Normalization" class="headerlink" title="特征缩放(Scaling)或归一化(Normalization)"></a>特征缩放(Scaling)或归一化(Normalization)</h3><h4 id="minmaxscaler"><a href="#minmaxscaler" class="headerlink" title="minmaxscaler　"></a>minmaxscaler　</h4><p>$x’=\frac{x-min}{max-min}$</p>
<p>Min-max缩放压缩（或拉伸）所有特征值到[0, 1 ]的范围内</p>
<p><img src="https://github.com/apachecn/fe4ml-zh/raw/master/images/chapter2/2-15.png" alt="img"></p>
<h4 id="Standardization"><a href="#Standardization" class="headerlink" title="Standardization"></a>Standardization</h4><p>$x’=\frac{x-\overline{x}}{\sigma}$</p>
<p>缩放后的特征的平均值为0, 方差为1。如果原始特征具有高斯分布, 则缩放特征为标准高斯</p>
<p><img src="/2019/10/08/machine-learning/feature-engineering-for-machine-learning/2-16.png" alt="img"></p>
<p>最小最大缩放和标准化都从原始特征值中减去一个数量，将稀疏特征的向量转换为一个稠密的向量。</p>
<h3 id="L2-Normalization"><a href="#L2-Normalization" class="headerlink" title="L2 Normalization"></a>L2 Normalization</h3><p>$x’=\frac{x}{\sqrt{\sum_{j} x_j^2}}$</p>
<p><img src="/2019/10/08/machine-learning/feature-engineering-for-machine-learning/2-17.png" alt="img"></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http:/2019/09/07/statitics/R/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Joseph.Fan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SAILOR">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/09/07/statitics/R/" class="post-title-link" itemprop="url">R notes</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-09-07 00:00:00" itemprop="dateCreated datePublished" datetime="2019-09-07T00:00:00+08:00">2019-09-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-10-09 01:30:37" itemprop="dateModified" datetime="2019-10-09T01:30:37+08:00">2019-10-09</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/ml/" itemprop="url" rel="index"><span itemprop="name">ml</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/ml/R/" itemprop="url" rel="index"><span itemprop="name">R</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http:/2019/08/26/System and Network/iptables/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Joseph.Fan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SAILOR">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/08/26/System and Network/iptables/" class="post-title-link" itemprop="url">iptables</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-08-26 00:00:00" itemprop="dateCreated datePublished" datetime="2019-08-26T00:00:00+08:00">2019-08-26</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-10-09 01:30:37" itemprop="dateModified" datetime="2019-10-09T01:30:37+08:00">2019-10-09</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/Newtork/" itemprop="url" rel="index"><span itemprop="name">Newtork</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Iptables"><a href="#Iptables" class="headerlink" title="Iptables"></a>Iptables</h2><p><a href="https://www.youtube.com/watch?v=iP8YWcvKDr0&amp;list=PLRRzkFBzCR3v-UefO69M7snZVzSnVlJKZ&amp;index=1" target="_blank" rel="noopener">https://www.youtube.com/watch?v=iP8YWcvKDr0&amp;list=PLRRzkFBzCR3v-UefO69M7snZVzSnVlJKZ&amp;index=1</a></p>
<p><img src="/2019/08/26/System and Network/iptables/1566825018363.png" alt="1566825018363"></p>
<h2 id="NAT"><a href="#NAT" class="headerlink" title="NAT"></a>NAT</h2><ol>
<li><p>SNAT, Source NAT</p>
<ul>
<li>改变 outgoing packet 的源 IP</li>
<li>跟踪链接，改变 reply packet 的目的 IP</li>
<li>可用作一组静态 IP addresses 的负载均衡</li>
</ul>
<p><img src="/2019/08/26/System and Network/iptables/1566826419768.png" alt="1566826419768"></p>
</li>
<li><p>DNAT, Destination NAT</p>
<ul>
<li>改变 incoming packet 的目的 IP，转发到其他设备</li>
<li>跟踪链接，改变 reply packet 的源 IP (由其他设备的源 IP 变为当前 DNAT 系统的源 IP)</li>
</ul>
<p>通常用在 inbound packets 的端口转发</p>
<p>只能用在 nat table, 和 PREROUTING and OUTPUT chains</p>
</li>
</ol>
<p><em>DMZ, 隔离区，DNAT 系统隔离的区域</em></p>
<p><img src="/2019/08/26/System and Network/iptables/1566826925512.png" alt="1566826925512"></p>
<ol start="3">
<li>IP Masquerading</li>
</ol>
<ul>
<li>A NAT route masquerades a private network</li>
<li>SNAT use outgoing intreface as the address for rewriting</li>
</ul>
<p><em>广泛用作 IPV4 的扩展</em></p>
<ul>
<li>private LAN using private IP address behind a NAT router, 所有流量都被视作来自 NAT router</li>
<li>所有来自private LAN 的流量都 NAT 到 NAT router 为源 IP</li>
<li>所有来自公网的流量都 NAT 处理后返回 private LAN devices</li>
</ul>
<h2 id="Iptables-Command"><a href="#Iptables-Command" class="headerlink" title="Iptables Command"></a>Iptables Command</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -A append to `INPUT` chain</span></span><br><span class="line"><span class="comment"># -m match, match against packet `state`</span></span><br><span class="line"><span class="comment"># -j jump, jump to `ACCEPT` target</span></span><br><span class="line"><span class="comment"># Appends a rule to the INPUT chain that matches the state of RELATED or ESTABLISHED, jump to the ACCEPT target</span></span><br><span class="line">-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line"><span class="comment"># -p protocol</span></span><br><span class="line">-A INPUT -p ICMP -j ACCEPT</span><br><span class="line"><span class="comment"># -i interface</span></span><br><span class="line">-A INPUT -i lo -j ACCEPT</span><br><span class="line"><span class="comment"># allow incoming SSH, any new coming tcp with dport 22</span></span><br><span class="line">-A INPUT -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT</span><br><span class="line"><span class="comment"># send and explicit rejection message of ICMP host-prohibited back to the sender, instead of quietly dropping a packet</span></span><br><span class="line">-A INPUT -j REJECT --reject-with icmp-host-prohibited</span><br><span class="line">-A FORWARD -j REJECT --reject-with icmp-host-prohibited</span><br></pre></td></tr></table></figure>
<h2 id="A-Basic-Router"><a href="#A-Basic-Router" class="headerlink" title="A Basic Router"></a>A Basic Router</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">A Router</span><br><span class="line">LAN: enp0s8, 172.16.0.0/24, private addresses</span><br><span class="line">WAN: enp0s3, , public address</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">*nat  <span class="comment"># nat table</span></span><br><span class="line"><span class="comment"># policies on PREROUTING, POSTROUTING, OUTPUT chains</span></span><br><span class="line">:PREROUTING ACCEPT [0:0]</span><br><span class="line">:POSTROUTING ACCEPT [0:0]</span><br><span class="line">:OUTPUT ACCEPT [0:0]</span><br><span class="line"><span class="comment"># SNAT: WAN port</span></span><br><span class="line"><span class="comment"># all packets leaving this machine with enp0s3 to have the source IP address of interface enp0s3</span></span><br><span class="line">-A POSTROUTING -o enp0s3 -j MASQUERADE</span><br><span class="line">COMMIT</span><br></pre></td></tr></table></figure>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">*filter  <span class="comment"># filter table</span></span><br><span class="line"><span class="comment"># default policies on INPUT, OUTPUT, FORWARD chains</span></span><br><span class="line">:INPUT DROP [0:0]</span><br><span class="line">:FORWARD DROP [0:0]</span><br><span class="line">:OUTPUT ACCEPT [0:0]</span><br><span class="line"><span class="comment"># INPUT chains, incomming connections from LAN side</span></span><br><span class="line"><span class="comment"># -s source, match source ip address in private LAN side addr range</span></span><br><span class="line">-A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT</span><br><span class="line">-A INPUT -i lo -j ACCEPT</span><br><span class="line">-A INPUT -s 172.16.0.0/24 -i enp0s8 -p icmp -j ACCEPT</span><br><span class="line">-A INPUT -s 172.16.0.0/24 -i enp0s8 -p tcp -m state --state NEW -m tcp --dport 22 -j ACCEPT</span><br><span class="line">-A INPUT -s 172.16.0.0/24 -i enp0s8 -p udp -m state --state NEW -m udp --dport 67 -j ACCEPT</span><br><span class="line"><span class="comment"># Condition Rejection</span></span><br><span class="line">-A INPUT -s 172.16.0.0/24 -i enp0s8 -j REJECT --reject-with icmp-host-prohibited</span><br><span class="line"><span class="comment"># if all above INPUT rules are not true, fall to the last rule: Drop all</span></span><br><span class="line">-A INPUT -j DROP</span><br><span class="line"></span><br><span class="line"><span class="comment"># FORWARD chains, FORWARD packets between LAN port and WAN port</span></span><br><span class="line"><span class="comment"># packets from LAN to LAN go directly, do not need route</span></span><br><span class="line">-A FORWARD -d 172.16.0.0/24 -i enp0s8 -j DROP</span><br><span class="line"><span class="comment"># ACCEPT all packets from LAN to WAN with source IP in the LAN,</span></span><br><span class="line"><span class="comment">#                and from WAN to LAN with detination IP in the LAN</span></span><br><span class="line">-A FORWARD -s 172.16.0.0/24 -i enp0s8 -j ACCEPT</span><br><span class="line">-A FORWARD -d 172.16.0.0/24 -i enp0s3 -j ACCEPT</span><br><span class="line">-A FORWARD -j DROP</span><br><span class="line"><span class="comment"># OUTPU chains, output packets </span></span><br><span class="line">-A OUTPUT -j ACCEPT</span><br><span class="line">COMMIT</span><br></pre></td></tr></table></figure>
<h2 id="Packets-Processing"><a href="#Packets-Processing" class="headerlink" title="Packets Processing"></a>Packets Processing</h2><p>Netfilter component of Linux kernel recognizes and grouped packets into <strong>streams or flows</strong></p>
<p>NAT rules are only determined for the 1st packet in a stream, the all subsequent packets receive the same processing</p>
<h2 id="Tables-and-Chains"><a href="#Tables-and-Chains" class="headerlink" title="Tables and Chains"></a>Tables and Chains</h2><h4 id="Tables"><a href="#Tables" class="headerlink" title="Tables"></a>Tables</h4><ul>
<li>filter</li>
<li>NAT</li>
<li>mangle</li>
<li>raw</li>
<li>security</li>
</ul>
<h4 id="Chains"><a href="#Chains" class="headerlink" title="Chains"></a>Chains</h4><ul>
<li>PREROUTING</li>
<li>INPUT</li>
<li>FORWARD</li>
<li>OUTPUT</li>
<li>POSTROUTING</li>
<li>User-defined Chains</li>
</ul>
<h3 id="Tables-and-built-in-chains"><a href="#Tables-and-built-in-chains" class="headerlink" title="Tables and built-in chains"></a>Tables and built-in chains</h3><h4 id="Filter-Access-Controls"><a href="#Filter-Access-Controls" class="headerlink" title="Filter:  Access Controls"></a>Filter:  Access Controls</h4><p>Built-in chains</p>
<ul>
<li>INPUT: handles packets <strong>destined for local sockets</strong></li>
<li>FORWARD: handles packets <strong>routed through</strong> this host to another destination</li>
<li>OUTPUT: handles <strong>locally generated</strong> packets</li>
</ul>
<h4 id="NAT-Consulted-whenever-a-packet-create-a-new-connection"><a href="#NAT-Consulted-whenever-a-packet-create-a-new-connection" class="headerlink" title="NAT: Consulted whenever a packet create a new connection"></a>NAT: Consulted whenever a packet create a new connection</h4><p>Built-in chains</p>
<ul>
<li>PREROUTING: alters packets <strong>arrive from</strong> the network interface</li>
<li>OUTPUT: alters <strong>locally-generated</strong> packets <strong>before routing</strong> them</li>
<li>POSTROUTING: alters packets about to be <strong>sent out</strong> from host</li>
</ul>
<h4 id="Mangle-specialized-packet-alteration"><a href="#Mangle-specialized-packet-alteration" class="headerlink" title="Mangle: specialized packet alteration"></a>Mangle: specialized packet alteration</h4><p>Built-in chains</p>
<ul>
<li>PREROUTING: mangling packets <strong>before routing</strong></li>
<li>OUTPUT: mangling packets <strong>before sending</strong></li>
<li>INPUT: mangling packets <strong>destined</strong> for this host</li>
<li>FORWARD: mangling packets <strong>routed through</strong> the host</li>
<li>POSTROUTING: mangling packets about <strong>to be sent</strong></li>
</ul>
<h4 id="Security-Consulted-after-the-filter-table-to-implement-Mandatory-Access-Control-network-rules"><a href="#Security-Consulted-after-the-filter-table-to-implement-Mandatory-Access-Control-network-rules" class="headerlink" title="Security: Consulted after the filter table to implement Mandatory Access Control network rules"></a>Security: Consulted after the filter table to implement Mandatory Access Control network rules</h4><p>Built-in chains</p>
<ul>
<li>INPUT: packets <strong>destined</strong> for the host</li>
<li>OUTPUT: packets <strong>originating</strong> from the host</li>
<li>FORWARD: packets <strong>forwarded through</strong> the host</li>
</ul>
<h4 id="Raw-rarely-used"><a href="#Raw-rarely-used" class="headerlink" title="Raw: rarely used"></a>Raw: rarely used</h4><p>Built-in chains</p>
<ul>
<li>PREROUTING: processes all incoming packets</li>
<li>OUTPUT: processes outgoing packets generated by the host</li>
</ul>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http:/2019/08/14/ElastiSearch/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Joseph.Fan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SAILOR">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/08/14/ElastiSearch/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-08-14 00:57:36" itemprop="dateCreated datePublished" datetime="2019-08-14T00:57:36+08:00">2019-08-14</time>
            

            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="ElasticSearch"><a href="#ElasticSearch" class="headerlink" title="ElasticSearch"></a>ElasticSearch</h2><p>数据库</p>
<p>数据分析平台</p>
<h4 id="Document-APIs"><a href="#Document-APIs" class="headerlink" title="Document APIs"></a><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.1/docs.html" target="_blank" rel="noopener">Document APIs</a></h4><table>
<thead>
<tr>
<th>RDBMS</th>
<th>Elastic Search</th>
</tr>
</thead>
<tbody>
<tr>
<td>Database</td>
<td>index</td>
</tr>
<tr>
<td>Table</td>
<td><del>Type</del></td>
</tr>
<tr>
<td>Row</td>
<td>Document</td>
</tr>
<tr>
<td>Column</td>
<td>Field</td>
</tr>
<tr>
<td>Schema</td>
<td>Mapping</td>
</tr>
<tr>
<td>Index</td>
<td>Everything is indexed</td>
</tr>
<tr>
<td>SQL</td>
<td>DSL</td>
</tr>
<tr>
<td>SELECT * FROM table …</td>
<td>GET <em>Index</em>/_doc/<em>doc_name</em> {filter}</td>
</tr>
<tr>
<td>UPDATE table SELECT …</td>
<td>PUT <em>Index</em>/_doc/<em>doc_name</em> {data}</td>
</tr>
</tbody>
</table>
<p>RMDS（关系型数据库）: 事务性 / Join</p>
<p>ElasticSearch: 相关性（Score）/　高性能全文检索</p>
<p>Index 索引，一类文档的集合</p>
<p>每个索引都有自己的 Mapping 定义，定义文档字段类型（string, number, list, object）</p>
<p>7.0 以前，一个 Index 可以配置多个 Types</p>
<p>6.0 开始，Type 已经被废除</p>
<p>7.0 开始，一个索引只能创建一个 Type - “_doc”</p>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/7.0/removal-of-types.html" target="_blank" rel="noopener">Removal of types</a></p>
<p>Mapping Type 由 Lucence field 决定，不同 Type 中的相同文档字段会共享同一个 Mapping.</p>
<p>加入我需要删除 A Type 中的 user_name 字段而保留 B Type 中的 user_name 字段，这就会引起歧义。同时也会影响 Lucence 压缩文档的性能</p>
<p>替代解决办法</p>
<p>直接添加<strong>Type</strong>字段</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">PUT twitter</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"mappings"</span>: &#123;</span><br><span class="line">    <span class="attr">"_doc"</span>: &#123;</span><br><span class="line">      <span class="attr">"properties"</span>: &#123;</span><br><span class="line">        <span class="attr">"type"</span>: &#123; <span class="attr">"type"</span>: <span class="string">"keyword"</span> &#125;, </span><br><span class="line">        <span class="attr">"name"</span>: &#123; <span class="attr">"type"</span>: <span class="string">"text"</span> &#125;,</span><br><span class="line">        <span class="attr">"user_name"</span>: &#123; <span class="attr">"type"</span>: <span class="string">"keyword"</span> &#125;,</span><br><span class="line">        <span class="attr">"email"</span>: &#123; <span class="attr">"type"</span>: <span class="string">"keyword"</span> &#125;,</span><br><span class="line">        <span class="attr">"content"</span>: &#123; <span class="attr">"type"</span>: <span class="string">"text"</span> &#125;,</span><br><span class="line">        <span class="attr">"tweeted_at"</span>: &#123; <span class="attr">"type"</span>: <span class="string">"date"</span> &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT twitter/_doc/user-kimchy</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"type"</span>: <span class="string">"user"</span>, </span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"Shay Banon"</span>,</span><br><span class="line">  <span class="attr">"user_name"</span>: <span class="string">"kimchy"</span>,</span><br><span class="line">  <span class="attr">"email"</span>: <span class="string">"shay@kimchy.com"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PUT twitter/_doc/tweet-1</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"type"</span>: <span class="string">"tweet"</span>, </span><br><span class="line">  <span class="attr">"user_name"</span>: <span class="string">"kimchy"</span>,</span><br><span class="line">  <span class="attr">"tweeted_at"</span>: <span class="string">"2017-10-24T09:00:00Z"</span>,</span><br><span class="line">  <span class="attr">"content"</span>: <span class="string">"Types are going away"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">GET twitter/_search</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">"query"</span>: &#123;</span><br><span class="line">    <span class="attr">"bool"</span>: &#123;</span><br><span class="line">      <span class="attr">"must"</span>: &#123;</span><br><span class="line">        <span class="attr">"match"</span>: &#123;</span><br><span class="line">          <span class="attr">"user_name"</span>: <span class="string">"kimchy"</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">"filter"</span>: &#123;</span><br><span class="line">        <span class="attr">"match"</span>: &#123;</span><br><span class="line">          <span class="attr">"type"</span>: <span class="string">"tweet"</span> </span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Bulk-API"><a href="#Bulk-API" class="headerlink" title="Bulk API"></a>Bulk API</h3><p>支持在一次 API 调用中，对不同的索引进行操作</p>
<h2 id="集群"><a href="#集群" class="headerlink" title="集群"></a>集群</h2><p><strong>节点</strong>: 一个 ElasticSearch 实例</p>
<p>Master-eligible nodes</p>
<p>Master Node</p>
<p>集群状态：Cluster Status</p>
<p>Data Node 数据节点</p>
<p>Coordinating Node，处理客户端请求，集群每个节点都起到 Coordinating Node 的作用，应对高并发</p>
<p><strong>分片</strong>：一个 Lucence 实例，解决数据水平扩展问题，解决数据高可用问题（读取的吞吐，IO）</p>
<h3 id="倒排索引"><a href="#倒排索引" class="headerlink" title="倒排索引"></a>倒排索引</h3><p>正排索引：目录，文档ID到文档内容</p>
<p>倒排索引：索引页，单词到文档ID的索引</p>
<p><a href="https://zh.wikipedia.org/wiki/%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95</a></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http:/2019/07/22/statitics/entropy/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Joseph.Fan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SAILOR">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/22/statitics/entropy/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-22 22:04:54" itemprop="dateCreated datePublished" datetime="2019-07-22T22:04:54+08:00">2019-07-22</time>
            

            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http:/2019/07/22/deep-learning/dropout/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Joseph.Fan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SAILOR">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/22/deep-learning/dropout/" class="post-title-link" itemprop="url">未命名</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-22 22:03:46" itemprop="dateCreated datePublished" datetime="2019-07-22T22:03:46+08:00">2019-07-22</time>
            

            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http:/2019/07/22/machine-learning/feature-engineering/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Joseph.Fan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SAILOR">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/22/machine-learning/feature-engineering/" class="post-title-link" itemprop="url">Feature Engineering</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-22 00:00:00" itemprop="dateCreated datePublished" datetime="2019-07-22T00:00:00+08:00">2019-07-22</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-10-09 01:20:20" itemprop="dateModified" datetime="2019-10-09T01:20:20+08:00">2019-10-09</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/ml/" itemprop="url" rel="index"><span itemprop="name">ml</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Feature-Engineering"><a href="#Feature-Engineering" class="headerlink" title="Feature Engineering"></a>Feature Engineering</h2><h1 id="1-数据预处理"><a href="#1-数据预处理" class="headerlink" title="1. 数据预处理"></a>1. 数据预处理</h1><p><strong>sklearn.preprocessing</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> StandardScaler</span><br><span class="line">StandardScaler().fit_transform(iris.data)</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>类</th>
<th></th>
<th>功能</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>StandardScaler</td>
<td>$x’=\frac{x-\overline{x}}{\sigma}$</td>
<td>标准化(无量纲化)</td>
<td>基于特征矩阵的列，将特征值转换至服从标准正态分布 $x ~ \mathcal{N}[0,1]$</td>
</tr>
<tr>
<td>MinMaxScaler</td>
<td>$x’=\frac{x-min}{max-min}$</td>
<td>(区间缩放)无量纲化</td>
<td>基于最大最小值，将特征值转换到[0, 1]区间上</td>
</tr>
<tr>
<td>Normalizer</td>
<td>$x’=\frac{x}{\sqrt{\sum_{j} x_j^2}}$</td>
<td>归一化</td>
<td>基于特征矩阵的行，将样本向量转换为“单位向量”</td>
</tr>
<tr>
<td>Binarizer</td>
<td>$x’=\begin{cases}1, x&gt;threshhold \ 0, x \leq threshold\end{cases}$</td>
<td>二值化</td>
<td>基于给定阈值，将定量特征按阈值划分</td>
</tr>
<tr>
<td>OneHotEncoder</td>
<td>000100,001000,…</td>
<td>哑编码(dummy)</td>
<td>将定性数据编码为定量数据</td>
</tr>
<tr>
<td>Imputer</td>
<td></td>
<td>缺失值计算(nan)</td>
<td>计算缺失值，缺失值可填充为均值等</td>
</tr>
<tr>
<td>PolynomialFeatures</td>
<td>$(x_1,x_2)=(1,x_1^2,x_2^2,x_1x_2)$</td>
<td>多项式数据转换</td>
<td>多项式数据转换</td>
</tr>
<tr>
<td>FunctionTransformer</td>
<td>FunctionTransformer(log1p).fit_transform(iris.data)</td>
<td>自定义单元数据转换</td>
<td>使用单变元的函数来转换数据</td>
</tr>
</tbody>
</table>
<h1 id="2-特征选择"><a href="#2-特征选择" class="headerlink" title="2. 特征选择"></a>2. 特征选择</h1><table>
<thead>
<tr>
<th>类</th>
<th>所属方式</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>VarianceThreshold</td>
<td>Filter</td>
<td>方差选择法</td>
</tr>
<tr>
<td>SelectKBest</td>
<td>Filter</td>
<td>可选关联系数、卡方校验、最大信息系数作为得分计算的方法</td>
</tr>
<tr>
<td>RFE</td>
<td>Wrapper</td>
<td>递归地训练基模型，将权值系数较小的特征从特征集合中消除</td>
</tr>
<tr>
<td>SelectFromModel</td>
<td>Embedded</td>
<td>训练基模型，选择权值系数较高的特征</td>
</tr>
</tbody>
</table>
<h1 id="3-降维"><a href="#3-降维" class="headerlink" title="3.降维"></a>3.降维</h1><p>PCA是为了让映射后的样本具有最大的发散性；而LDA是为了让映射后的样本有最好的分类性能。所以说PCA是一种无监督的降维方法，而LDA是一种有监督的降维方法。</p>
<table>
<thead>
<tr>
<th>库</th>
<th>类</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>decomposition</td>
<td>PCA</td>
<td>主成分分析法</td>
</tr>
<tr>
<td>lda</td>
<td>LDA</td>
<td>线性判别分析法</td>
</tr>
</tbody>
</table>
<p>References:</p>
<ol>
<li><a href="https://www.cnblogs.com/jasonfreak/p/5448385.html" target="_blank" rel="noopener">https://www.cnblogs.com/jasonfreak/p/5448385.html</a></li>
<li><a href="https://sklearn.apachecn.org/#/docs/" target="_blank" rel="noopener">https://sklearn.apachecn.org/#/docs/</a></li>
<li></li>
</ol>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http:/2019/07/01/deep-learning/cnn/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Joseph.Fan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SAILOR">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/07/01/deep-learning/cnn/" class="post-title-link" itemprop="url">CNN</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-07-01 00:00:00" itemprop="dateCreated datePublished" datetime="2019-07-01T00:00:00+08:00">2019-07-01</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-04 01:21:54" itemprop="dateModified" datetime="2019-07-04T01:21:54+08:00">2019-07-04</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/dl/" itemprop="url" rel="index"><span itemprop="name">dl</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Covolution-Neuro-Network"><a href="#Covolution-Neuro-Network" class="headerlink" title="Covolution Neuro Network"></a>Covolution Neuro Network</h2><h2 id="卷积"><a href="#卷积" class="headerlink" title="卷积"></a>卷积</h2><p>卷积运算，源于信号处理</p>
<h4 id="感受野，接受域"><a href="#感受野，接受域" class="headerlink" title="感受野，接受域"></a>感受野，接受域</h4><p><img src="/2019/07/01/deep-learning/cnn/90af0bd67ba498239688c81fd61bbc66_hd.jpg" alt="img"></p>
<p>只受３个输入单元影响，接受域为３，忽略接受域外权重（无限强先验）</p>
<h4 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h4><ul>
<li><p>稀疏交互</p>
</li>
<li><p>参数共享，在不同输入位置上使用相同的参数。普通神经网络权重与神经元绑定，需要 $N_l <em> N_{l+1}$ 个参数；卷积神经网络每个权重参数不变，只需要 $k</em>k$ 个参数。</p>
</li>
<li>平移不变性，只包含局部连接关系（接受域）</li>
</ul>
<p><img src="/2019/07/01/deep-learning/cnn/dd62e1d75bda9b592dabb91627d68aa6_hd.jpg" alt="img"></p>
<p>96个[11x11x3]滤波器，如果在图像某些地方探测到一个水平的边界是很重要，那么在其他一些地方也会同样是有用的，这是因为图像结构具有平移不变性。</p>
<p>有的滤波器学习到了条纹，有些学到了色彩差别</p>
<h4 id="CNN"><a href="#CNN" class="headerlink" title="CNN"></a>CNN</h4><p>输出尺寸：$\frac{W-F+2P}{S} + 1$</p>
<ul>
<li>F: fiter, 卷积核/滤波器/感受野的尺寸，常用3x3, 5x5</li>
<li>P: padding, 零填充的数量. SAME(输出与输入保持一直，p=F-1/S)，VALID(不填充，输出尺寸减少, p=F/S)</li>
<li>S: stride, 步长</li>
</ul>
<h4 id="code"><a href="#code" class="headerlink" title="code"></a>code</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># forward</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">conv_forward_naive</span><span class="params">(x, w, b, conv_param)</span>:</span></span><br><span class="line">    <span class="comment"># input x: N data points, C channels, height H, width W</span></span><br><span class="line">    N, C, H, W = x.shape</span><br><span class="line">    <span class="comment"># filter w: (F, C, HH, WW)</span></span><br><span class="line">    F, _, HH, WW = w.shape</span><br><span class="line">    </span><br><span class="line">    stride, pad = conv_param[<span class="string">'stride'</span>], conv_param[<span class="string">'pad'</span>]</span><br><span class="line">    H_out = <span class="number">1</span> + (H + <span class="number">2</span> * pad - HH) // stride  </span><br><span class="line">    W_out = <span class="number">1</span> + (W + <span class="number">2</span> * pad - WW) // stride</span><br><span class="line">    out = np.zeros((N, F, H_out, W_out))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># ０填充</span></span><br><span class="line">    x_pad = np.pad(x, ((<span class="number">0</span>,), (<span class="number">0</span>,), (pad,), (pad,)), mode=<span class="string">'constant'</span>, constant_values=<span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># out: (N, F, H', W')  F filters</span></span><br><span class="line">    <span class="comment"># N个输入格式一致，直接在矩阵中操作</span></span><br><span class="line">    <span class="comment"># 遍历输出点高度和宽度(h_out, w_out)</span></span><br><span class="line">    <span class="comment"># 输出点从上到下，从左到右移动</span></span><br><span class="line">    <span class="keyword">for</span> h_out <span class="keyword">in</span> range(H_out):</span><br><span class="line">        <span class="keyword">for</span> w_out <span class="keyword">in</span> range(W_out):</span><br><span class="line">            <span class="comment"># 获得当前卷积核对应的输入块（HH,WW）</span></span><br><span class="line">            x_pad_block = x_pad[:, :, h_out*stride:h_out*stride+HH, w_out*stride:w_out*stride+WW]</span><br><span class="line">            <span class="comment"># 计算每个卷积核（滤波器 f）得到的输出，对应点（h_out, w_out)</span></span><br><span class="line">            <span class="keyword">for</span> f <span class="keyword">in</span> range(F):</span><br><span class="line">                out[:, f, h_out, w_out] = np.sum(x_pad_block * w[f, :, :, :], axis=(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>)) + b[f]</span><br><span class="line"></span><br><span class="line">    cache = (x, w, b, conv_param)</span><br><span class="line">    <span class="keyword">return</span> out, cache</span><br><span class="line"></span><br><span class="line"><span class="comment"># backward</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">conv_backward_naive</span><span class="params">(dout, cache)</span>:</span></span><br><span class="line">    x, w, b, conv_param = cache</span><br><span class="line">    N, C, H, W = x.shape</span><br><span class="line">    F, _, HH, WW = w.shape</span><br><span class="line">    _, _, H_out, W_out = dout.shape</span><br><span class="line">    stride, pad = conv_param[<span class="string">'stride'</span>], conv_param[<span class="string">'pad'</span>]</span><br><span class="line">	</span><br><span class="line">    <span class="comment"># 0填充　padding</span></span><br><span class="line">    x_pad = np.pad(x, ((<span class="number">0</span>,), (<span class="number">0</span>,), (pad,), (pad,)), mode=<span class="string">'constant'</span>, constant_values=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    dx_pad = np.zeros_like(x_pad)</span><br><span class="line">    dw = np.zeros_like(w)</span><br><span class="line">    db = np.zeros_like(b)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 遍历数据输入n</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> range(N):</span><br><span class="line">        <span class="comment"># 遍历 filter f</span></span><br><span class="line">        <span class="keyword">for</span> f <span class="keyword">in</span> range(F):</span><br><span class="line">            <span class="comment"># db (N,F)</span></span><br><span class="line">            db[f] += np.sum(dout[n, f])</span><br><span class="line">            <span class="comment"># 遍历输出点高度和宽度　[h,w]</span></span><br><span class="line">            <span class="keyword">for</span> h_out <span class="keyword">in</span> range(H_out):</span><br><span class="line">                <span class="keyword">for</span> w_out <span class="keyword">in</span> range(W_out):</span><br><span class="line">                    <span class="comment"># 获得当前卷积核f对应的输入块（HH,WW）</span></span><br><span class="line">                    x_pad_block = x_pad[n, :, h_out*stride:h_out*stride+HH, w_out*stride:w_out*stride+WW]</span><br><span class="line">                    <span class="comment"># dw (F,)</span></span><br><span class="line">                    dw[f, :, :, :] += x_pad_block * dout[n, f, h_out, w_out]</span><br><span class="line">                    dx_pad[n, :, h_out*stride:h_out*stride+HH, w_out*stride:w_out*stride+WW] += \</span><br><span class="line">                        w[f, :, :, :] * dout[n, f, h_out, w_out]</span><br><span class="line"></span><br><span class="line">    dx = dx_pad[:, :, pad:pad+H, pad:pad+W]</span><br><span class="line">	</span><br><span class="line">    <span class="comment"># return Gradients: dx, dw, db</span></span><br><span class="line">    <span class="keyword">return</span> dx, dw, db</span><br></pre></td></tr></table></figure>
<p><em>卷积层是如何解决不同大小输入的问题 ???</em></p>
<h2 id="池化"><a href="#池化" class="headerlink" title="池化"></a>池化</h2><h4 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h4><ul>
<li>局部平移不变性：关心某个特征是否出现，不关心出现的具体位置　（无限强先验）</li>
<li>降采样：下一层少了 k 倍输入</li>
<li>综合池化区域(pool)的 k*k 个像素的统计特征</li>
<li>处理不同大小的输入，输出相同数量的统计特征</li>
</ul>
<p>最大池化 pool (2, 2)，步长 stride 2，输出大小减半</p>
<p><img src="/2019/07/01/deep-learning/cnn/641c8846abcb02d35938660cf96cef1b_hd.jpg" alt="img"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">max_pool_forward_naive</span><span class="params">(x, pool_param)</span>:</span> </span><br><span class="line">    <span class="comment"># input x: (N, C, H, W)</span></span><br><span class="line">    N, C, H, W = x.shape</span><br><span class="line">    <span class="comment"># pool region: (heigth, width), stride</span></span><br><span class="line">    pool_height = pool_param[<span class="string">'pool_height'</span>]</span><br><span class="line">    pool_width = pool_param[<span class="string">'pool_width'</span>]</span><br><span class="line">    stride = pool_param[<span class="string">'stride'</span>]</span><br><span class="line">    <span class="comment"># output: (N, C, H', W')</span></span><br><span class="line">    H_out = <span class="number">1</span> + (H - pool_height) // stride </span><br><span class="line">    W_out = <span class="number">1</span> + (W - pool_width) // stride</span><br><span class="line">    out = np.zeros((N, C, H_out, W_out))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 遍历输出点高度和宽度 [h,w]</span></span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> range(H_out):</span><br><span class="line">        <span class="keyword">for</span> w <span class="keyword">in</span> range(W_out):</span><br><span class="line">            <span class="comment"># pool对应的输入块</span></span><br><span class="line">            x_pad_block = x[:, :, h*stride:h*stride+pool_height, w*stride:w*stride+pool_width]</span><br><span class="line">            <span class="comment"># 最大池化，输出到　[:, :, h, w]</span></span><br><span class="line">            out[:, :, h, w] = np.max(x_pad_block, axis=(<span class="number">-1</span>, <span class="number">-2</span>))</span><br><span class="line"></span><br><span class="line">    cache = (x, pool_param)</span><br><span class="line">    <span class="keyword">return</span> out, cache</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">max_pool_backward_naive</span><span class="params">(dout, cache)</span>:</span></span><br><span class="line">    x, pool_param = cache</span><br><span class="line">    N, C, H, W = x.shape</span><br><span class="line">    <span class="comment"># pool region: (heigth, width), stride</span></span><br><span class="line">    pool_height = pool_param[<span class="string">'pool_height'</span>]</span><br><span class="line">    pool_width = pool_param[<span class="string">'pool_width'</span>]</span><br><span class="line">    stride = pool_param[<span class="string">'stride'</span>]</span><br><span class="line">    <span class="comment"># output: (N, C, H', W')</span></span><br><span class="line">    H_out = <span class="number">1</span> + (H - pool_height) // stride </span><br><span class="line">    W_out = <span class="number">1</span> + (W - pool_width) // stride</span><br><span class="line">    <span class="comment"># 初始化梯度　dx</span></span><br><span class="line">    dx = np.zeros_like(x)</span><br><span class="line">     </span><br><span class="line">    <span class="comment"># 遍历输入 n</span></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> range(N):</span><br><span class="line">        <span class="comment"># 遍历filter c</span></span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> range(C):</span><br><span class="line">            <span class="comment"># 遍历输出点高度和宽度 [h, w]</span></span><br><span class="line">            <span class="keyword">for</span> h <span class="keyword">in</span> range(H_out):</span><br><span class="line">                <span class="keyword">for</span> w <span class="keyword">in</span> range(W_out):</span><br><span class="line">                    <span class="comment"># 当前输出点对应的 pool 输入块</span></span><br><span class="line">                    x_pad_block = x[n, c, h*stride:h*stride+pool_height, w*stride:w*stride+pool_width]</span><br><span class="line">                    <span class="comment"># Find the index (row, col) of the max value</span></span><br><span class="line">                    <span class="comment"># grads on the max value is exists, else is 0</span></span><br><span class="line">                    index = np.unravel_index(np.argmax(x_pad_block, axis=<span class="keyword">None</span>), (pool_height, pool_width))</span><br><span class="line">                    <span class="comment"># pool对应的输入块各点的梯度</span></span><br><span class="line">                    <span class="comment"># 只有pool输入块中最大值对应的点(索引index)存在梯度，等于dout[n, c, h, w]，其余点梯度为0</span></span><br><span class="line">                    dx[n, c, h*stride:h*stride+pool_height, w*stride:w*stride+pool_width][index] = dout[n, c, h, w]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dx</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http:/2019/06/22/deep-learning/back_propagation/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Joseph.Fan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="SAILOR">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/22/deep-learning/back_propagation/" class="post-title-link" itemprop="url">Back Propagation</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-22 00:00:00" itemprop="dateCreated datePublished" datetime="2019-06-22T00:00:00+08:00">2019-06-22</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-07-02 23:35:45" itemprop="dateModified" datetime="2019-07-02T23:35:45+08:00">2019-07-02</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/dl/" itemprop="url" rel="index"><span itemprop="name">dl</span></a></span>

                
                
              
            </span>
          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Backpropagation"><a href="#Backpropagation" class="headerlink" title="Backpropagation"></a>Backpropagation</h2><p>Reference: <a href="https://kratzert.github.io/2016/02/12/understanding-the-gradient-flow-through-the-batch-normalization-layer.html" target="_blank" rel="noopener">Understanding the backward pass through Batch Normalization Layer</a></p>
<h4 id="全连接网络数据指示图"><a href="#全连接网络数据指示图" class="headerlink" title="全连接网络数据指示图"></a>全连接网络数据指示图</h4><p><img src="/2019/06/22/deep-learning/back_propagation/1561185066736.png" alt="1561185066736"></p>
<p>$$w = w - \eta dw$$</p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Joseph.Fan</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">17</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">4</span>
                    <span class="site-state-item-name">分类</span>
                  
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">4</span>
                    <span class="site-state-item-name">标签</span>
                  
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Joseph.Fan</span>

  

  
</div>


  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v6.7.0</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=6.7.0"></script>

  <script src="/js/src/motion.js?v=6.7.0"></script>



  
  


  <script src="/js/src/affix.js?v=6.7.0"></script>

  <script src="/js/src/schemes/pisces.js?v=6.7.0"></script>




  

  


  <script src="/js/src/bootstrap.js?v=6.7.0"></script>



  



  





  

  

  

  

  
  

  
  
    
      
    
      
        
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  

  
    
      <script type="text/x-mathjax-config">
  

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      
      equationNumbers: {
        autoNumber: "AMS"
      }
    }
  });
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
      for (i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
  });
</script>
<script src="//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

<style>
.MathJax_Display {
  overflow: auto hidden;
}
</style>

    
  


  

  

  

  

  

  

  

  

</body>
</html>
